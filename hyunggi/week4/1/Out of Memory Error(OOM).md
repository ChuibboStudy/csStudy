<!-- TOC -->

* [잘 운영하고 있던 어플리케이션이 갑자기  `Out of Memory Error(OOM)` 를 내며 프로세스가 종료되었습니다. 어떻게 대처해볼 수 있을까요?](#잘-운영하고-있던-어플리케이션이-갑자기-out-of-memory-erroroom-를-내며-프로세스가-종료되었습니다-어떻게-대처해볼-수-있을까요)
* [OOM의 원인은 어떻게 파악해볼 수 있을까요?](#oom의-원인은-어떻게-파악해볼-수-있을까요)
* [OOM의 원인을 로그만 가지고 파악하는게 가능할까요?](#oom의-원인을-로그만-가지고-파악하는게-가능할까요)
* [힙 덤프란 무엇인가요?](#힙-덤프란-무엇인가요)
* [힙 덤프는 어떻게 생성할 수 있을까요?](#힙-덤프는-어떻게-생성할-수-있을까요)
* [첫 질문으로 돌아가자면 운영중인 어플리케이션이 갑작스럽게 종료된건데, 어플리케이션이 종료된 상태에서 힙덤프를 생성하는게 가능한가요?](#첫-질문으로-돌아가자면-운영중인-어플리케이션이-갑작스럽게-종료된건데-어플리케이션이-종료된-상태에서-힙덤프를-생성하는게-가능한가요)

<!-- TOC -->

# 잘 운영하고 있던 어플리케이션이 갑자기  `Out of Memory Error(OOM)` 를 내며 프로세스가 종료되었습니다. 어떻게 대처해볼 수 있을까요?

1. `JVM에 초기 메모리 할당을 증가` : 애플리케이션의 메모리 요구가 증가한 경우, JVM에 더 많은 메모리를 할당해야 할 수 있습니다. 이는 `-Xms` 및 `-Xmx` 와 같은 JVM 플래그를 사용하여 초기
   및
   최대 메모리 크기를 설정합니다.
2. `코드 최적화` : 비효율적인 메모리 사용을 식별하기 위해 코드를 검토합니다. 일반적인 문제에는 큰 데이터 구조, 불필요한 객체 유지, 캐싱의 부적절한 사용 등이 있습니다.
   리팩토링 및 코드 최적화는 메모리 요구 사항을 크게 줄일 수 있습니다.
3. `메모리 사용 분석` : Java 프로파일러(예: VisualVM, YourKit, JProfiler)와 같은 도구를 사용하여 애플리케이션의 런타임을 분석하고 메모리 누수 및 기타 문제를 식별할 수 있습니다.
4. `가비지 컬렉션 튜닝` : JVM의 가비지 컬렉터는 다양한 플래그와 옵션을 사용하여 성능을 튜닝할 수 있습니다. 가비지 컬렉션 프로세스를 이해하고 이것이 애플리케이션의 특성과 어떻게 관련되는지 이해하는 것이
   중요할 수 있습니다.
5. `로깅 및 모니터링` : 메모리 문제를 조기에 포착하기 위해 견고한 로깅 및 모니터링을 구현합니다. 이는 시간이 지남에 따라 메모리 사용 패턴을 이해하는 데에도 도움이 될 수 있습니다.
6. `아키텍처 변경` : 일부 경우에는 아키텍처 변경이 필요할 수 있습니다. 이는 애플리케이션을 마이크로서비스로 분해하여 메모리 부하를 분산시키는 것을 포함할 수 있습니다.

이러한 전략들을 적용함으로써, 메모리 부족 오류를 효과적으로 해결하고 애플리케이션의 전반적인 성능과 안정성을 개선할 수 있습니다.

# OOM의 원인은 어떻게 파악해볼 수 있을까요?

1. `힙 메모리 분석` : VisualVM, YourKit 또는 JProfiler와 같은 메모리 프로파일링 도구를 사용하여 힙 메모리 사용량을 분석합니다.
   이러한 도구는 메모리 누수, 대형 개체 및 비효율적인 메모리 사용 패턴을 식별하는 데 도움이 될 수 있습니다.
2. `Garbage Collection 로그` :  Garbage Collection 로그를 분석하면 메모리 할당 및 할당 취소 패턴에 대한 통찰력을 얻을 수 있습니다.
   빈번하거나 긴 Garbage Collection 주기는 메모리 문제를 나타낼 수 있습니다.
3. `스레드 덤프` : 때때로 OOM 오류가 발생할 때 수행된 스레드 덤프는 메모리 집약적인 작업이나 메모리 소모를 초래하는 차단된 스레드를 드러낼 수 있습니다.
4. `애플리케이션 코드 검토` : 닫히지 않은 리소스, 대규모 컬렉션 또는 불필요한 객체 보존과 같은 일반적인 메모리 누수 패턴에 대한 애플리케이션 코드를 검토하는 것이 필수적입니다.
5. `시스템 지표 모니터링` : CPU 사용량, 디스크 I/O, 네트워크 트래픽과 같은 시스템 지표는 메모리 스트레스의 잠재적 원인을 간접적으로 암시할 수 있습니다.

# OOM의 원인을 로그만 가지고 파악하는게 가능할까요?

로그에만 의존하여 OOM 오류의 원인을 확인하는 것은 어려울 수 있지만 불가능하지는 않습니다.

접근 방법은 다음과 같습니다.

- `오류 및 예외 로그` : OOM 오류로 이어지는 패턴이나 반복되는 예외를 찾습니다. 이는 메모리가 과도하게 사용되거나 제대로 해제되지 않는 영역을 나타낼 수 있습니다.
- `Garbage Collection 로그` : 앞서 언급했듯이 이러한 로그는 잠재적인 가능성을 나타낼 수 있는 메모리 할당 및 할당 취소 동작을 이해하는 데 필수적입니다.

# 힙 덤프란 무엇인가요?

- 힙 덤프는 특정 시점의 Java 애플리케이션 메모리 스냅 샷입니다. 여기에는 클래스, 필드, 기본 유형 및 이들 간의 참조를 포함하여 힙의 모든 객체에 대한 정보가 포함됩니다.
  힙 덤프는 애플리케이션의 메모리 사용량을 분석하는 데 중요하며 메모리 누수 및 기타 메모리 관련 문제를 진단하는 데 자주 사용됩니다.

# 힙 덤프는 어떻게 생성할 수 있을까요?

- `JVM 인수 사용` : `XX:+HeapDumpOnOutOfMemoryError` 인수를 사용하여 메모리 부족 오류 시 힙 덤프를 생성하도록 JVM을 구성할 수 있습니다.
  OOM 오류가 발생하면 자동으로 힙 덤프 파일이 생성됩니다.
- `JConsole 또는 VisualVM 사용` : JConsole 또는 VisualVM과 같은 도구는 실행 중인 JVM에 연결하여 수동으로 힙 덤프를 트리거할 수 있습니다.
- `jmap 사용` : JDK와 함께 제공되는 `jmap` 도구를 사용하여 실행 중인 Java 애플리케이션의 힙 덤프를 생성할 수 있습니다.
  명령은 일반적으로 `jmap -dump:live,format=b,file=heapdump.hprof <PID>` 입니다. 여기서 `<PID>` 는 Java 애플리케이션의 프로세스 ID입니다.

# 첫 질문으로 돌아가자면 운영중인 어플리케이션이 갑작스럽게 종료된건데, 어플리케이션이 종료된 상태에서 힙덤프를 생성하는게 가능한가요?

- 안타깝게도 애플리케이션이 이미 종료된 경우 종료 당시 상태의 힙 덤프를 생성할 수 없습니다.
  힙 덤프는 애플리케이션이 계속 실행되는 동안 또는 오류가 발생하는 순간(예: `-XX:+HeapDumpOnOutOfMemoryError` JVM 인수 사용) 생성되어야 합니다.
  (※ OOM으로 인해 애플리케이션이 자주 충돌하는 경우 OOM 오류 발생 시 힙 덤프를 생성하도록 구성하는 것이 좋습니다.)
