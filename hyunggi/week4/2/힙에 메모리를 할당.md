<!-- TOC -->

* [힙에 메모리를 할당하는 과정에서 어떤 일들이 벌어지나요?](#힙에-메모리를-할당하는-과정에서-어떤-일들이-벌어지나요)
* [TLAB이란 무엇일까요?](#tlab이란-무엇일까요)
* [이것은 어떤 문제를 해결하기 위해 만들어진 것일까요?](#이것은-어떤-문제를-해결하기-위해-만들어진-것일까요)

<!-- TOC -->

# 힙에 메모리를 할당하는 과정에서 어떤 일들이 벌어지나요?

힙에 메모리를 할당하려면 일반적으로 지정된 크기의 메모리 블록을 요청해야 하며, 그런 다음 시스템의 메모리 관리자가 이를 할당합니다. 이 메모리는 프로그래밍 언어에 따라 프로그래머가 명시적으로 해제하거나
할당을 취소하거나 가비지 수집기에 의해 자동으로 할당 해제될 때까지 할당된 상태로 유지됩니다.

세부 프로세스:

1. 할당 요청: 프로그램이 힙의 메모리 블록을 요청합니다. 이는 C의 'malloc', C++의 'new' 또는 Java 및 Python과 같은 언어의 객체 인스턴스화와 같은 특정 할당 함수 또는 연산자를
   통해 수행됩니다.
2. 운영 체제에 의한 메모리 관리: 운영 체제의 메모리 관리자는 힙에 사용 가능한 여유 메모리가 충분한지 확인합니다. 힙은 동적 메모리 할당에 사용되는 메모리 영역입니다.
3. 메모리 블록 할당: 사용 가능한 메모리가 충분한 경우 메모리 관리자는 힙에 연속적인 메모리 블록을 할당하고 이 메모리 블록에 대한 포인터나 참조를 반환합니다. 이 블록의 크기는 요청된 크기와 일치합니다.
4. 초기화(선택 사항): 사용된 프로그래밍 언어 및 특정 명령에 따라 이 메모리는 초기화되거나(예: 0으로) 초기화되지 않은 상태로 남아 있을 수 있습니다.
5. 메모리 사용: 그러면 프로그램은 이 할당된 메모리를 사용하여 데이터를 저장할 수 있습니다. 자동 가비지 수집 없이 언어에서 이 메모리를 관리하는 것은 프로그래머의 책임입니다.
6. 할당 해제: 더 이상 필요하지 않은 경우 프로그램은 메모리 할당을 명시적으로 해제해야 합니다(C에서 `free` 사용, C++에서 `delete` 사용 등). 가비지 수집 기능이 있는 언어(예:
   Java 또는 Python)에서 가비지 수집기는 메모리가 더 이상 사용되지 않는 것을 감지하면 자동으로 메모리 할당을 취소합니다.

# TLAB이란 무엇일까요?

TLAB는 스레드 로컬 할당 버퍼를 나타냅니다. JVM(Java Virtual Machine)의 메모리 관리에 사용되는 개념입니다.

TLAB는 새 객체를 할당하기 위해 각 스레드에 대해 JVM의 힙에 할당된 특정 메모리 영역입니다. TLAB를 사용하면 각 스레드가 자체 버퍼를 갖기 때문에 여러 스레드가 메모리를 할당할 때 경합이
줄어듭니다.

1. `TLAB의 목적`: JVM과 같은 다중 스레드 환경에서 스레드는 자주 힙에 개체를 할당합니다. 모든 할당에 스레드 간의 동기화가 필요한 경우 상당한 성능 오버헤드가 발생할 수 있습니다.
   이러한 경합을 최소화하기 위해 TLAB가 도입되었습니다.
2. `TLAB에서의 할당`: JVM의 각 스레드에는 객체를 할당할 수 있는 TLAB라고 하는 힙의 작은 부분이 제공됩니다. 이 할당은 다른 스레드와 동기화할 필요 없이 발생하므로 프로세스 속도가 빨라집니다.
3. `크기 및 관리`: TLAB의 크기는 일반적으로 힙의 작은 부분이며 가비지 수집기에 의해 관리됩니다. JVM은 런타임 통계를 기반으로 TLAB의 크기를 조정하여 성능을 최적화할 수 있습니다.
4. `폴백 메커니즘`: 스레드의 TLAB 공간이 부족해지면 새 TLAB를 할당하거나 동기화가 필요한 공유 할당 영역으로 폴백할 수 있습니다.
5. `효율성 및 성능`: JVM은 TLAB를 사용하여 멀티스레드 환경에서 객체 할당 비용을 크게 줄여 전반적인 성능을 향상시킬 수 있습니다.
6. `가비지 수집`: TLAB에서 생성된 개체는 공유 힙에 할당된 개체와 동일한 가비지 수집 프로세스를 따릅니다.

# 이것은 어떤 문제를 해결하기 위해 만들어진 것일까요?

JVM(Java Virtual Machine)의 TLAB(Thread Local Allocation Buffer)는 멀티스레드 환경에서 메모리 할당과 관련된 성능 문제를 해결하기 위해 만들어졌습니다.

TLAB는 다중 스레드 컨텍스트에서 메모리 할당 중 경합 문제를 해결합니다. TLAB는 각 스레드에 자체 할당 버퍼를 제공함으로써 힙에 객체를 할당할 때 스레드 간 동기화의 필요성을 줄여 성능을
향상시킵니다.

1. `다중 스레드 할당의 경합`: 다중 스레드 애플리케이션에서는 여러 스레드가 동시에 힙에 메모리를 할당하려고 시도할 수 있습니다. TLAB가 없으면 모든 할당에는 메모리 일관성을 보장하기 위해 스레드가 서로
   동기화되어야 합니다. 이러한 동기화는 특히 병렬 처리 수준이 높은 애플리케이션에서 심각한 병목 현상이 될 수 있습니다.
2. `할당 효율성 향상`: TLAB를 사용하면 각 스레드는 다른 스레드와 동기화할 필요 없이 힙의 자체 버퍼에 개체를 할당할 수 있습니다. 대부분의 할당에서 비용이 많이 드는 동기화 오버헤드가 제거되므로 할당
   프로세스 속도가 크게 향상됩니다.
3. `동기화 오버헤드 감소`: TLAB가 없는 JVM에서 스레드는 힙 할당을 위해 전역 잠금을 위해 경쟁해야 하며, 이로 인해 스레드 경합이 발생하고 객체 할당의 대기 시간이 늘어납니다. TLAB는 이러한 경합을
   최소화하여 스레드가 보다 독립적이고 효율적으로 작동할 수 있도록 합니다.
4. `소형 개체 할당에 최적화됨`: TLAB는 Java 애플리케이션에서 일반적인 시나리오인 작은 개체를 자주 할당하는 데 특히 효과적입니다.
5. `적응형 크기 관리`: JVM은 런타임 성능 지표를 기반으로 TLAB의 크기를 적응적으로 조정하여 메모리 사용 및 할당 효율성을 최적화할 수 있습니다.

요약하면, TLAB는 동기화 필요성을 줄이고 전체 애플리케이션 성능을 향상시킴으로써 특히 멀티스레드 컨텍스트에서 JVM의 메모리 할당 프로세스를 최적화하기 위해 도입되었습니다.
